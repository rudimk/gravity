syntax = "proto3";

package installer;

// Agent defines a service to install a cluster
service Agent {
    // Handshake allows for a simple client validation.
    // It allows the service to validate whether the client is using
    // the configured modality.
    rpc Handshake(HandshakeRequest) returns (HandshakeResponse);

    // Execute runs installer operation to completion
    rpc Execute(ExecuteRequest) returns (stream ProgressResponse);

    // Shutdown requests that the installer exit
    rpc Shutdown(ShutdownRequest) returns (ShutdownResponse);

    // Abort requests that the installer service aborts and cleans up
    // the state of the operation
    rpc Abort(AbortRequest) returns (AbortResponse);
}

// HandshakeRequest describes a request for service to validate the client
message HandshakeRequest {
    // Token specifies the startup token for validation
    string token = 1;
}

// HandshakeResponse describes the server response to the handshake request
message HandshakeResponse {
}

// ExecuteRequest describes a request to execute install operation
message ExecuteRequest {
}

// ShutdownRequest describes a request to shut down the process
message ShutdownRequest {
}

// ShutdownResponse describes the server response to the shut down request
message ShutdownResponse {
}

// AbortRequest describes a request to abort the operation and clean up
message AbortRequest {
}

// AbortResponse describes the server response to the abort request
message AbortResponse {
    // Error specifies the error from the abort handler
    Error error = 1;
}

// ProgressResponse describes a single progress step
message ProgressResponse {
    // Message specifies the progress message
    string message = 1;
    // Complete indicates whether the operation is complete
    bool complete = 2;
    // Errors lists errors for this progress step
    repeated Error errors = 3;
}

// Error represents an error in the operation
message Error {
    // Message specifies the error message
    string message = 1;
}
